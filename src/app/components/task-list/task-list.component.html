<div class="task-container">
  <!-- Input de busqueda -->
  <div class="search-bar mt-3 d-flex align-items-center">
    <input
      type="text"
      class="form-control custom-input"
      placeholder="Buscar..."
      [formControl]="searchControl"
    />
    <button
      class="btn btn-primary ml-2 button-add"
      data-bs-toggle="modal"
      data-bs-target="#modalAgregar"
    >
      <i
        class="bi bi-plus-circle"
        style="font-size: 2rem; color: cornflowerblue"
      ></i>
    </button>
  </div>

  <!-- Botones Completado y Pendiente -->
  <div class="d-flex justify-content-between">
    <div class="button-group mt-3">
      <button
        class="btn"
        [ngClass]="{
          'btn-primary': selectedStatus === 0,
          'btn-secondary': selectedStatus !== 0
        }"
        (click)="filterTasksByStatus(0)"
      >
        Pendiente
      </button>
      <button
        class="btn"
        [ngClass]="{
          'btn-primary': selectedStatus === 1,
          'btn-secondary': selectedStatus !== 1
        }"
        (click)="filterTasksByStatus(1)"
      >
        En Progreso
      </button>
      <button
        class="btn"
        [ngClass]="{
          'btn-primary': selectedStatus === 2,
          'btn-secondary': selectedStatus !== 2
        }"
        (click)="filterTasksByStatus(2)"
      >
        Completado
      </button>
    </div>
    <button
      class="btn ml-2 btn-trash"
      data-bs-toggle="modal"
      data-bs-target="#modalEliminar"
      [disabled]="selectedTasks.length === 0"
    >
      <i class="bi bi-trash-fill"></i>
    </button>
  </div>

  <!-- Contenedor de Tareas -->
  <div class="task-list">
    <div *ngIf="filteredTasks.length === 0; else taskList">
      <p class="no-results"> No se encontraron tareas con ese nombre.</p>
    </div>
    <ng-template #taskList>
      <div
        class="task-item"
        *ngFor="let task of filteredTasks; trackBy: trackByTaskId"
        @fadeOut
        (click)="toggleDropdown(task.id)"
      >
        <input
          class="form-check-input"
          type="checkbox"
          [checked]="selectedTasks.includes(task.id)"
          (change)="toggleSelection(task.id)"
          (click)="$event.stopPropagation()"
        />
        <div class="task-info">
          <h4>{{ task.titulo }}</h4>
          <p>{{ task.descripcion }}</p>
        </div>
        <span [ngClass]="getEstadoClass(task.estado)">{{
          getEstado(task.estado)
        }}</span>

        <!-- Boton de opciones -->
        <div class="dropdown" [ngClass]="{ show: isDropdownOpen(task.id) }">
          <button
            class="btn btn-options dropdown"
            type="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            &#8226;&#8226;&#8226;
          </button>
          <ul
            class="dropdown-menu"
            [ngClass]="{ show: isDropdownOpen(task.id) }"
          >
            <li>
              <a class="dropdown-item" (click)="editTask(task)">Editar</a>
            </li>
            <li>
              <a class="dropdown-item" (click)="deleteTaskSelected(task.id)"
                >Eliminar</a
              >
            </li>
          </ul>
        </div>
      </div>
    </ng-template>
  </div>

  <!-- Modal Agregar/Editar -->
  <div
    class="modal fade"
    id="modalAgregar"
    tabindex="-1"
    aria-hidden="true"
    aria-labelledby="modalAgregarlLabel"
  >
    <app-task-add
      (taskAdded)="onTaskAdded()"
      (taskUpdated)="updateTaskInList($event)"
    ></app-task-add>
  </div>
</div>

<div
  class="modal fade"
  id="modalEliminar"
  tabindex="-1"
  aria-hidden="true"
  aria-labelledby="modalEliminarLabel"
>
  <app-confirm-modal-custom
    [title]="modalTitle"
    [message]="modalMessage"
    (onConfirm)="deleteSelectedTasks()"
  ></app-confirm-modal-custom>
</div>
